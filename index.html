<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>炫酷打砖块 | 多难度版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body { 
            font-family: 'Arial', sans-serif; 
            text-align: center; 
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .game-header {
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
        }
        .game-header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .control-panel {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            max-width: 500px;
            margin: 0 auto 20px;
        }
        .difficulty-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .difficulty-btn.active {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255,255,255,0.8);
        }
        .easy {
            background: #2ecc71;
            color: white;
        }
        .hard {
            background: #e74c3c;
            color: white;
        }
        #gameArea {
            position: relative;
            width: 600px;
            height: 450px;
            border: 3px solid #fff;
            margin: 0 auto;
            background: rgba(0,0,0,0.5);
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        #paddle {
            position: absolute;
            width: 100px;
            height: 15px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            bottom: 20px;
            left: 250px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.8);
            transition: all 0.05s ease;
        }
        #ball {
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #e67e22 0%, #d35400 100%);
            border-radius: 50%;
            left: 292px;
            top: 200px;
            box-shadow: 0 0 15px rgba(230, 126, 34, 0.9);
        }
        .brick {
            position: absolute;
            width: 70px;
            height: 25px;
            margin: 2px;
            border-radius: 5px;
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }
        .brick:hover {
            transform: scale(1.02);
        }
        .stats {
            display: flex;
            justify-content: space-between;
            max-width: 600px;
            margin: 15px auto;
            font-size: 1.2rem;
            text-shadow: 0 0 5px #000;
        }
        /* 粒子效果样式 */
        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            animation: particle 0.6s ease-out forwards;
        }
        @keyframes particle {
            0% { opacity: 1; }
            100% { opacity: 0; transform: translate(var(--x), var(--y)); }
        }
        /* 游戏开始/暂停提示 */
        #gameMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            text-shadow: 0 0 20px rgba(255,255,255,0.9);
            opacity: 0.8;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="game-header">
        <h1>炫酷打砖块</h1>
    </div>
    
    <div class="control-panel">
        <button class="difficulty-btn easy active" id="easyBtn">简单模式</button>
        <button class="difficulty-btn hard" id="hardBtn">困难模式</button>
        <div>
            <span>分数: <span id="score">0</span></span>
        </div>
    </div>

    <div class="stats">
        <div>剩余砖块: <span id="brickCount">0</span></div>
        <div>小球速度: <span id="speedInfo">正常</span></div>
    </div>

    <div id="gameArea">
        <div id="paddle"></div>
        <div id="ball"></div>
        <div id="gameMessage">点击开始游戏</div>
    </div>

    <script>
        // 获取元素
        const gameArea = document.getElementById('gameArea');
        const paddle = document.getElementById('paddle');
        const ball = document.getElementById('ball');
        const brickCountEl = document.getElementById('brickCount');
        const scoreEl = document.getElementById('score');
        const speedInfoEl = document.getElementById('speedInfo');
        const gameMessage = document.getElementById('gameMessage');
        const easyBtn = document.getElementById('easyBtn');
        const hardBtn = document.getElementById('hardBtn');

        // 游戏参数
        let ballX = 292, ballY = 200;
        let ballSpeedX = 2, ballSpeedY = -2;
        let paddleX = 250;
        let bricks = [];
        let brickCount = 0;
        let score = 0;
        let gameRunning = false;
        let gameLoopId = null;
        let difficulty = 'easy'; // 默认简单模式
        const speedSettings = {
            easy: { x: 2, y: -2, maxX: 4, label: '正常' },
            hard: { x: 3.5, y: -3.5, maxX: 6, label: '快速' }
        };

        // 初始化游戏
        initGame();

        // 难度切换事件
        easyBtn.addEventListener('click', () => {
            setDifficulty('easy');
        });

        hardBtn.addEventListener('click', () => {
            setDifficulty('hard');
        });

        // 鼠标移动控制挡板
        gameArea.addEventListener('mousemove', (e) => {
            const rect = gameArea.getBoundingClientRect();
            paddleX = e.clientX - rect.left - paddle.offsetWidth / 2;
            paddleX = Math.max(0, Math.min(paddleX, gameArea.offsetWidth - paddle.offsetWidth));
            paddle.style.left = `${paddleX}px`;
        });

        // 点击开始游戏
        gameArea.addEventListener('click', () => {
            if (!gameRunning) {
                startGame();
            }
        });

        // 设置难度
        function setDifficulty(mode) {
            difficulty = mode;
            // 更新按钮样式
            easyBtn.classList.toggle('active', mode === 'easy');
            hardBtn.classList.toggle('active', mode === 'hard');
            
            // 更新速度参数
            ballSpeedX = speedSettings[mode].x;
            ballSpeedY = speedSettings[mode].y;
            speedInfoEl.textContent = speedSettings[mode].label;
            
            // 如果游戏正在运行，重置小球速度
            if (gameRunning) {
                // 保留当前方向，只改变速度大小
                ballSpeedX = Math.abs(ballSpeedX) / Math.abs(ballSpeedX) * speedSettings[mode].x;
                ballSpeedY = Math.abs(ballSpeedY) / Math.abs(ballSpeedY) * speedSettings[mode].y * -1;
            }
        }

        // 初始化游戏
        function initGame() {
            initBricks();
            resetBall();
            updateStats();
        }

        // 开始游戏
        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            gameMessage.style.display = 'none';
            // 启动游戏循环
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // 重置小球位置和速度
        function resetBall() {
            ballX = gameArea.offsetWidth / 2 - ball.offsetWidth / 2;
            ballY = gameArea.offsetHeight / 2;
            ballSpeedX = speedSettings[difficulty].x;
            ballSpeedY = speedSettings[difficulty].y * -1;
            ball.style.left = `${ballX}px`;
            ball.style.top = `${ballY}px`;
        }

        // 游戏循环
        function gameLoop() {
            if (!gameRunning) return;

            // 移动小球
            ballX += ballSpeedX;
            ballY += ballSpeedY;

            // 检测左右边界碰撞（添加反弹特效）
            if (ballX <= 0 || ballX >= gameArea.offsetWidth - ball.offsetWidth) {
                ballSpeedX = -ballSpeedX;
                createParticles(ballX + ball.offsetWidth/2, ballY + ball.offsetHeight/2, 8, '#3498db');
            }

            // 检测上边界碰撞
            if (ballY <= 0) {
                ballSpeedY = -ballSpeedY;
                createParticles(ballX + ball.offsetWidth/2, ballY, 8, '#9b59b6');
            }

            // 检测下边界（游戏结束）
            if (ballY >= gameArea.offsetHeight - ball.offsetHeight) {
                endGame('游戏结束！');
                return;
            }

            // 检测挡板碰撞（更真实的物理效果）
            checkPaddleCollision();

            // 检测砖块碰撞
            checkBrickCollision();

            // 更新小球位置
            ball.style.left = `${ballX}px`;
            ball.style.top = `${ballY}px`;

            // 更新统计信息
            updateStats();

            // 检查是否通关
            if (brickCount === 0) {
                endGame(`恭喜通关！最终得分: ${score}`);
                return;
            }

            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // 检测挡板碰撞
        function checkPaddleCollision() {
            const paddleTop = gameArea.offsetHeight - paddle.offsetHeight - 20;
            const paddleBottom = paddleTop + paddle.offsetHeight;
            const ballBottom = ballY + ball.offsetHeight;

            if (
                ballBottom >= paddleTop &&
                ballY <= paddleBottom &&
                ballX + ball.offsetWidth >= paddleX &&
                ballX <= paddleX + paddle.offsetWidth
            ) {
                // 计算碰撞位置，让反弹角度更丰富
                const collisionPoint = (ballX + ball.offsetWidth/2) - (paddleX + paddle.offsetWidth/2);
                const normalizedCollision = collisionPoint / (paddle.offsetWidth/2);
                
                // 根据难度设置最大速度
                const maxX = speedSettings[difficulty].maxX;
                ballSpeedX = normalizedCollision * maxX;
                ballSpeedY = -Math.abs(ballSpeedY);
                
                // 添加碰撞特效
                createParticles(ballX + ball.offsetWidth/2, ballY, 10, '#3498db');
                
                // 挡板轻微缩放特效
                paddle.style.transform = 'scaleX(1.1)';
                setTimeout(() => {
                    paddle.style.transform = 'scaleX(1)';
                }, 50);
            }
        }

        // 初始化砖块（多彩砖块）
        function initBricks() {
            // 清除旧砖块
            bricks.forEach(brick => gameArea.removeChild(brick));
            bricks = [];
            brickCount = 0;
            score = 0;

            // 砖块颜色数组
            const brickColors = [
                'linear-gradient(90deg, #9b59b6, #8e44ad)',
                'linear-gradient(90deg, #e74c3c, #c0392b)',
                'linear-gradient(90deg, #f39c12, #d35400)',
                'linear-gradient(90deg, #1abc9c, #16a085)',
                'linear-gradient(90deg, #3498db, #2980b9)'
            ];

            // 创建砖块（6行8列，更密集）
            const brickWidth = 70;
            const brickHeight = 25;
            const gap = 2;
            const cols = Math.floor(gameArea.offsetWidth / (brickWidth + gap));
            const rows = 6;

            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const brick = document.createElement('div');
                    brick.classList.add('brick');
                    brick.style.left = `${col * (brickWidth + gap)}px`;
                    brick.style.top = `${row * (brickHeight + gap) + 20}px`;
                    // 随机颜色
                    brick.style.background = brickColors[Math.floor(Math.random() * brickColors.length)];
                    // 随机加分值（10-30分）
                    brick.dataset.points = Math.floor(Math.random() * 20) + 10;
                    gameArea.appendChild(brick);
                    bricks.push(brick);
                    brickCount++;
                }
            }
        }

        // 检测砖块碰撞
        function checkBrickCollision() {
            for (let i = bricks.length - 1; i >= 0; i--) {
                const brick = bricks[i];
                const brickRect = brick.getBoundingClientRect();
                const ballRect = ball.getBoundingClientRect();
                const gameAreaRect = gameArea.getBoundingClientRect();

                // 转换为游戏区域内的坐标
                const brickX = brickRect.left - gameAreaRect.left;
                const brickY = brickRect.top - gameAreaRect.top;

                // 精确碰撞检测
                if (
                    ballRect.right > brickRect.left &&
                    ballRect.left < brickRect.right &&
                    ballRect.bottom > brickRect.top &&
                    ballRect.top < brickRect.bottom
                ) {
                    // 计算碰撞方向（上下/左右）
                    const ballCenterX = ballRect.left + ballRect.width / 2;
                    const ballCenterY = ballRect.top + ballRect.height / 2;
                    const brickCenterX = brickRect.left + brickRect.width / 2;
                    const brickCenterY = brickRect.top + brickRect.height / 2;

                    const hitFromSide = Math.abs(ballCenterX - brickCenterX) > Math.abs(ballCenterY - brickCenterY);
                    
                    if (hitFromSide) {
                        ballSpeedX = -ballSpeedX;
                    } else {
                        ballSpeedY = -ballSpeedY;
                    }

                    // 添加爆炸粒子特效
                    createExplosion(brickX + brick.offsetWidth/2, brickY + brick.offsetHeight/2);
                    
                    // 加分
                    score += Number(brick.dataset.points);
                    
                    // 移除砖块
                    gameArea.removeChild(brick);
                    bricks.splice(i, 1);
                    brickCount--;
                    
                    break;
                }
            }
        }

        // 创建粒子特效
        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.background = color || '#e67e22';
                
                // 随机方向和距离
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 30 + 10;
                particle.style.setProperty('--x', `${Math.cos(angle) * distance}px`);
                particle.style.setProperty('--y', `${Math.sin(angle) * distance}px`);
                
                gameArea.appendChild(particle);
                
                // 移除粒子
                setTimeout(() => {
                    particle.remove();
                }, 600);
            }
        }

        // 创建砖块爆炸特效
        function createExplosion(x, y) {
            createParticles(x, y, 15, getRandomColor());
        }

        // 获取随机颜色
        function getRandomColor() {
            const colors = ['#ff7e5f', '#feb47b', '#2ecc71', '#3498db', '#9b59b6', '#e74c3c'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // 更新统计信息
        function updateStats() {
            brickCountEl.textContent = brickCount;
            scoreEl.textContent = score;
        }

        // 结束游戏
        function endGame(message) {
            gameRunning = false;
            cancelAnimationFrame(gameLoopId);
            
            setTimeout(() => {
                alert(message + `\n得分: ${score}`);
                // 重置游戏
                resetGame();
            }, 100);
        }

        // 重置游戏
        function resetGame() {
            gameMessage.style.display = 'block';
            gameMessage.textContent = '点击开始游戏';
            paddleX = (gameArea.offsetWidth - paddle.offsetWidth) / 2;
            paddle.style.left = `${paddleX}px`;
            initBricks();
            resetBall();
            updateStats();
        }

        // 游戏主循环
        function gameLoop() {
            if (!gameRunning) return;
            
            // 移动小球
            ballX += ballSpeedX;
            ballY += ballSpeedY;
            
            // 更新小球位置
            ball.style.left = `${ballX}px`;
            ball.style.top = `${ballY}px`;
            
            // 碰撞检测
            checkBoundaries();
            checkPaddleCollision();
            checkBrickCollision();
            
            // 更新统计
            updateStats();
            
            // 检查通关
            if (brickCount === 0) {
                endGame(`恭喜你通关了！\n最终得分: ${score}`);
                return;
            }
            
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // 边界检测
        function checkBoundaries() {
            // 左右边界
            if (ballX <= 0 || ballX >= gameArea.offsetWidth - ball.offsetWidth) {
                ballSpeedX = -ballSpeedX;
                createParticles(ballX + ball.offsetWidth/2, ballY, 8, '#3498db');
            }
            
            // 上边界
            if (ballY <= 0) {
                ballSpeedY = -ballSpeedY;
                createParticles(ballX + ball.offsetWidth/2, ballY, 8, '#9b59b6');
            }
            
            // 下边界（游戏结束）
            if (ballY >= gameArea.offsetHeight - ball.offsetHeight) {
                endGame(`游戏结束！\n得分: ${score}`);
            }
        }
    </script>
</body>
</html>
